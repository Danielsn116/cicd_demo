parameters:
  - name: templatePath
    type: string
    default: '$(System.DefaultWorkingDirectory)'
  - name: bicepBuild
    type: string

steps:
  - task: PowerShell@2
    displayName: 'Build ${{ parameters.bicepBuild }} Bicep file'
    inputs:
      targetType: 'inline'
      script: |
        $Params = @{
          Task = 'BuildBicep'
          TemplatePath = "${{ parameters.templatePath }}\${{ parameters.bicepBuild }}"
          servicePrincipal = "`$(contributor-app-registration-id)"
          spSecret = '$(contributor-service-principal-secret)'
          tenant = "`$(tenant-id)"
        }
        Invoke-Build @Params